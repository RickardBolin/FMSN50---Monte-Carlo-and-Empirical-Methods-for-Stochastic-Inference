clc
clear
load coal_mine_disasters.mat

% Number of breakpoints (not including start and end)
d = 1;

% Hyperparameter chosen by us
psi = 10;

% Initial breakpoints (together with start- and endpoint)
t =linspace(1658, 1980, d+2)';

% Draw initial values from the priors. With d breakpoints, we get d+1 intervals
theta = gamrnd(2*ones(d+1,1), ones(d+1,1)*1/psi);
lambda = gamrnd(2*ones(d+1,1), ones(d+1,1)*1./theta);
cond_lambda = lambda; % For later

for steps = 1:100
    % Get number of accidents in each interval
    startpoints = t(1:end-1);
    endpoints = t(2:end);
    accidents = zeros(length(startpoints), 1);
    for i = 1:length(startpoints)
        accidents(i) = sum(length(T(find(T > startpoints(i) & T < endpoints(i)))));
    end

    cond_theta = gamrnd((2*d+2)*ones(1,d+1), (1./(psi+sum(cond_lambda))).*ones(1,d+1));
    cond_lambda = gamrnd((accidents'+1), (endpoints-startpoints)*cond_theta);
    t = MCMC_MH(cond_lambda, t, accidents);
end
figure
plot(t)

